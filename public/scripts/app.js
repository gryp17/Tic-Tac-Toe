function common(){toastr.options={positionClass:"toast-top-center"}}function game(){io("/game")}function index(){$("#login-form button").click(function(){$.ajax({url:"/login",type:"POST",data:$("#login-form").serialize()}).done(function(t){t.user?window.location.href="/lobby":toastr.error(t)})}),$("#signup-form .signup-btn").click(function(){var t=new FormData(document.getElementById("signup-form"));$.ajax({url:"/signup",type:"POST",enctype:"multipart/form-data",processData:!1,contentType:!1,data:t}).done(function(t){t.user?window.location.href="/lobby":toastr.error(t)})}),$(".browse-btn, .avatar-preview").click(function(){$(".avatar").click()}),$(".avatar").change(function(t){$(".avatar-preview").attr("src",URL.createObjectURL(t.target.files[0]))})}function lobby(){function t(){var t=$("#chat input[type=text]").val();t=t.trim(),$("#chat input[type=text]").val(""),t.length>0&&a.emit("chatMessage",t)}var a=io("/lobby");$(".avatar-preview").click(function(){$(".avatar").click()}),$("#update-avatar-form .avatar").change(function(){var t=new FormData(document.getElementById("update-avatar-form"));$.ajax({url:"/user/updateAvatar",type:"POST",enctype:"multipart/form-data",processData:!1,contentType:!1,data:t}).done(function(t){if(t.avatar){var a=$(".avatar-preview").attr("src");a=a.replace(/[^\/]+?$/,t.avatar),$(".avatar-preview").attr("src",a)}else toastr.error(t)})}),$("#chat button").click(function(){t()}),$("#chat input[type=text]").keypress(function(a){13===a.which&&t()}),a.on("chatMessage",function(t){var a=moment(t.date),e=$("<div>",{"class":"message "+t.type}),n=$("<span>",{"class":"timestamp",title:a.format("YYYY-MM-DD HH:mm:ss"),text:"["+a.format("HH:mm:ss")+"]"});if(e.append(n),"user"===t.type){var r=$("<span>",{"class":"author",text:t.author.username+":"});e.append(r)}var o=$("<span>",{"class":"content",text:t.message});e.append(o),$("#chat .chat-body").append(e);var c=$("#chat .chat-body")[0].scrollHeight;$("#chat .chat-body").scrollTop(c)}),a.on("updateUsersList",function(t){$("#users-list").empty(),t.forEach(function(t){var a=$("<div>",{id:t.id,"class":"alert alert-success",text:t.username,title:"Invite "+t.username+" for a game",click:function(){var t=$(this).attr("id");console.log("clicked "+t)}}),e=$("<img>",{"class":"avatar",src:"/upload/avatars/"+t.avatar});a.prepend(e);var n=$("<span>",{"class":"glyphicon glyphicon-info-sign"}),r=$("<a>",{"class":"user-info",href:"/user/"+t.id,target:"_blank",title:"View user info"});r.append(n),a.append(r),$("#users-list").append(a)})})}$(document).ready(function(){window[$("body").attr("class")](),common()});