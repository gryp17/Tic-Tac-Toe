function common(){toastr.options={positionClass:"toast-top-center"}}function game(){io("/game")}function index(){$("#login-form button").click(function(){$.ajax({url:"/login",type:"POST",data:$("#login-form").serialize()}).done(function(a){a.user?window.location.href="/lobby":toastr.error(a)})}),$("#signup-form .signup-btn").click(function(){var a=new FormData(document.getElementById("signup-form"));$.ajax({url:"/signup",type:"POST",enctype:"multipart/form-data",processData:!1,contentType:!1,data:a}).done(function(a){a.user?window.location.href="/lobby":toastr.error(a)})}),$(".browse-btn, .avatar-preview").click(function(){$(".avatar").click()}),$(".avatar").change(function(a){$(".avatar-preview").attr("src",URL.createObjectURL(a.target.files[0]))})}function lobby(){function a(){var a=$("#chat input[type=text]").val();a=a.trim(),$("#chat input[type=text]").val(""),a.length>0&&n.emit("chatMessage",a)}function e(){var a=$(this).attr("id");a!==t&&($("#challenge-pending-modal").modal({backdrop:"static",keyboard:!1,show:!0}),n.emit("challengeUser",a))}var t=$("#user-id").val(),n=io("/lobby");$(".avatar-preview").click(function(){$(".avatar").click()}),$("#update-avatar-form .avatar").change(function(){var a=new FormData(document.getElementById("update-avatar-form"));$.ajax({url:"/user/updateAvatar",type:"POST",enctype:"multipart/form-data",processData:!1,contentType:!1,data:a}).done(function(a){if(a.avatar){var e=$(".avatar-preview").attr("src");e=e.replace(/[^\/]+?$/,a.avatar),$(".avatar-preview").attr("src",e)}else toastr.error(a)})}),$("#chat button").click(function(){a()}),$("#chat input[type=text]").keypress(function(e){13===e.which&&a()}),n.on("chatMessage",function(a){var e=moment(a.date),t=$("<div>",{"class":"message "+a.type}),n=$("<span>",{"class":"timestamp",title:e.format("YYYY-MM-DD HH:mm:ss"),text:"["+e.format("HH:mm:ss")+"]"});if(t.append(n),"user"===a.type){var o=$("<span>",{"class":"author",text:a.author.username+":"});t.append(o)}var c=$("<span>",{"class":"content",text:a.message});t.append(c),$("#chat .chat-body").append(t);var l=$("#chat .chat-body")[0].scrollHeight;$("#chat .chat-body").scrollTop(l)}),n.on("updateUsersList",function(a){$("#users-list").empty(),a.forEach(function(a){var t=$("<div>",{id:a.id,"class":"alert alert-success",text:a.username,title:"Invite "+a.username+" for a game",click:e}),n=$("<img>",{"class":"avatar",src:"/upload/avatars/"+a.avatar});t.prepend(n);var o=$("<span>",{"class":"glyphicon glyphicon-info-sign"}),c=$("<a>",{"class":"user-info",href:"/user/"+a.id,target:"_blank",title:"View user info"});c.append(o),t.append(c),$("#users-list").append(t)})}),n.on("challenge",function(a){console.log("received challenge from"),console.log(a),$("#challenge-modal .challenger").html(a.username),$("#challenge-modal .challenger").attr("href","/user/"+a.id),$("#challenge-modal").modal({backdrop:"static",keyboard:!1,show:!0})}),n.on("cancelChallenge",function(){$("#challenge-modal").modal("hide"),$("#challenge-pending-modal").modal("hide")}),$("#challenge-modal .btn-success").click(function(){console.log("challenge accepted")}),$("#challenge-modal .btn-danger").click(function(){console.log("challenge declined")}),$("#challenge-pending-modal .btn-danger").click(function(){console.log("challenge canceled by the challenger")}),n.on("updateGamesList",function(a){console.log("received games list"),console.log(a)})}$(document).ready(function(){window[$("body").attr("class")](),common()});